<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Migren Araştırma Projesi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {font-family: 'Inter', sans-serif; background:#0f172a; color:#e2e8f0; margin:0; padding:0;}
    .container {max-width:800px; margin:20px auto; padding:20px; background:#1e293b; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.5);}
    h1, h2 {color:#60a5fa; text-align:center;}
    p {line-height:1.7;}
    .step {display:none;}
    .step.active {display:block;}
    input, select, textarea {width:100%; padding:12px; margin:10px 0; border-radius:8px; border:none; background:#334155; color:white;}
    label {display:block; margin:15px 0 5px; font-weight:500;}
    button {background:#60a5fa; color:white; padding:14px 30px; border:none; border-radius:8px; cursor:pointer; font-size:16px; margin:10px 5px;}
    button:hover {background:#3b82f6;}
    .progress {height:8px; background:#334155; border-radius:4px; margin:20px 0;}
    .progress-bar {height:100%; background:#60a5fa; width:0%; border-radius:4px; transition:width 0.4s;}
    .checkbox-label {display:flex; align-items:center; gap:12px; font-weight:normal; margin:12px 0; flex-wrap:wrap;}
    .final-buttons {text-align:center; margin:30px 0;}
    a {color:#60a5fa; text-decoration:underline; cursor:pointer;}
  </style>
</head>
<body>
<div class="container">

  <!-- 0. Hoş Geldiniz -->
  <div id="step-0" class="step active">
    <h1>Migren Araştırmasına Hoş Geldiniz</h1>
    <p>Merhaba, ben Dr. Demirsoy, nöroloji alanında çalışan bir araştırmacıyım.</p>
    <p>Bu proje ile migren hastalarının günlük yaşamlarını, tetikleyicilerini ve hastalık şiddetini daha iyi anlamayı amaçlıyorum. Topladığımız tüm veriler <strong>sadece bilimsel araştırma amacıyla</strong> kullanılacak ve hiçbir şekilde üçüncü kişilerle paylaşılmayacaktır.</p>
    <p>Katılım tamamen gönüllülük esasına dayalıdır ve istediğiniz zaman vazgeçebilirsiniz.</p>
    <div style="text-align:center; margin:30px 0;">
      <button onclick="nextStep(1)">Devam Et →</button>
    </div>
  </div>

  <!-- 1. KVKK Onay + Popup -->
  <div id="step-1" class="step">
    <h2>Kişisel Verilerin Korunması</h2>
    <p>Bu araştırmada toplanan tüm verileriniz 6698 sayılı Kişisel Verilerin Korunması Kanunu’na uygun şekilde işlenecektir.</p>
    <p><strong><a href="javascript:void(0)" onclick="showKVKK()">KVKK Aydınlatma Metni’ni okumak için tıklayın</a></strong></p>
    <p><strong>Bilgilerimin yukarıdaki şekilde işlenmesini kabul ediyor musunuz?</strong></p>
    <div style="text-align:center; margin:40px 0;">
      <button style="background:#ef4444;" onclick="Swal.fire({title:'Üzgünüz',text:'KVKK onayı olmadan devam edemezsiniz. İleride tekrar denemek isterseniz bekleriz. ❤️',icon:'warning',confirmButtonText:'Tamam'})">Hayır</button>
      <button onclick="nextStep(2)">Evet, kabul ediyorum</button>
    </div>
  </div>

  <!-- 2. İletişim Bilgileri -->
  <div id="step-2" class="step">
    <h2>İletişim Bilgileriniz</h2>
    <p>Araştırma sonuçlarını ve ileride yapacağımız çalışmaları sizinle paylaşabilmek için lütfen aşağıdaki bilgileri giriniz.</p>
    <label>Ad Soyad <span style="color:#fba0a0;">*</span></label>
    <input type="text" id="fullName" required placeholder="Ayşe Yılmaz">
    <label>Telefon Numarası <span style="color:#fba0a0;">*</span></label>
    <input type="tel" id="phone" required placeholder="05xx xxx xx xx">
    <label>E-posta Adresi <span style="color:#fba0a0;">*</span></label>
    <input type="email" id="email" required placeholder="ornek@mail.com">
    <div style="text-align:center; margin:30px 0;">
      <button onclick="saveAndNext(2,3)">İleri →</button>
    </div>
  </div>

  <div class="progress"><div class="progress-bar" id="progress"></div></div>

  <!-- 3. Demografik -->
  <div id="step-3" class="step">
    <h2>1. Demografik Bilgiler</h2>
    <label>Yaşınız</label><input type="number" id="age" required>
    <label>Cinsiyet</label>
    <select id="gender"><option value="">Seçiniz</option><option>Erkek</option><option>Kadın</option><option>Diğer</option><option>Belirtmek istemiyorum</option></select>
    <label>Eğitim seviyeniz</label>
    <select id="education"><option value="">Seçiniz</option><option>İlkokul</option><option>Ortaokul</option><option>Lise</option><option>Üniversite</option><option>Yüksek Lisans/Doktora</option></select>
    <label>Çalışma durumu</label>
    <select id="work"><option value="">Seçiniz</option><option>Çalışıyorum</option><option>Çalışmıyorum</option><option>Emekli</option><option>Öğrenci</option></select>
    <div style="text-align:center;"><button onclick="saveAndNext(3,4)">İleri →</button></div>
  </div>

  <!-- 4. Migren Taraması -->
  <div id="step-4" class="step">
    <h2>2. Migreniniz Var mı?</h2>
    <label>Son 3 ayda tekrarlayan şiddetli baş ağrılarınız oldu mu?</label>
    <select id="headache3months"><option value="">Seçiniz</option><option>Evet</option><option>Hayır</option></select>
    <label>Baş ağrısı sırasında ışığa veya sese hassasiyet oluyor mu?</label>
    <select id="photosensitivity"><option value="">Seçiniz</option><option>Evet</option><option>Hayır</option></select>
    <label>Bulantı veya kusma eşlik ediyor mu?</label>
    <select id="nausea"><option value="">Seçiniz</option><option>Evet</option><option>Hayır</option></select>
    <div style="text-align:center;"><button onclick="saveAndNext(4,5)">İleri →</button></div>
  </div>

  <!-- 5. Atak Özellikleri -->
  <div id="step-5" class="step">
    <h2>3. Migren Ataklarınızın Özellikleri</h2>
    <label>Ayda ortalama kaç migren atağı geçiriyorsunuz?</label><input type="number" id="attacksPerMonth">
    <label>Ataklarınız ortalama kaç saat sürüyor?</label><input type="number" id="durationHours">
    <label>En şiddetli ağrı seviyeniz (0-10)</label><input type="number" min="0" max="10" id="painLevel">
    <div style="text-align:center;"><button onclick="saveAndNext(5,6)">İleri →</button></div>
  </div>

  <!-- 6. Tetikleyiciler -->
  <div id="step-6" class="step">
    <h2>4. Tetikleyiciler ve Yaşam Tarzı</h2>
    <p>Aşağıdakilerden hangileri sizin migreninizi tetikliyor? (Birden fazla seçebilirsiniz)</p>
    <label class="checkbox-label"><input type="checkbox" value="Stres"> Stres</label>
    <label class="checkbox-label"><input type="checkbox" value="Uykusuzluk"> Uykusuzluk</label>
    <label class="checkbox-label"><input type="checkbox" value="Çikolata"> Çikolata / kafein</label>
    <label class="checkbox-label"><input type="checkbox" value="Alkol"> Alkol</label>
    <label class="checkbox-label"><input type="checkbox" value="Parfüm"> Parfüm / güçlü kokular</label>
    <label class="checkbox-label"><input type="checkbox" value="Hava değişimi"> Hava değişimi</label>
    <label class="checkbox-label"><input type="checkbox" value="Adet dönemi"> Adet dönemi</label>
    <label>Başka tetikleyiciler varsa yazınız:</label><textarea id="otherTriggers"></textarea>
    <div style="text-align:center;"><button onclick="saveAndNext(6,7)">İleri →</button></div>
  </div>

  <!-- 7. MIDAS Karar -->
  <div id="step-7" class="step">
    <h2>5. Son Kısım: MIDAS Ölçeği</h2>
    <p>Buraya kadar teşekkür ederiz! Şimdi migreninizin günlük yaşamınıza etkisini ölçen MIDAS ölçeğini uygulamak istiyoruz.</p>
    <p>Devam etmek istiyor musunuz?</p>
    <div class="final-buttons">
      <button style="background:#f59e0b;" onclick="continueLater()">Hayır, daha sonra devam etmek istiyorum</button>
      <button onclick="nextStep(8)">Evet, hemen devam edeyim</button>
    </div>
  </div>

  <!-- 8. MIDAS Soruları -->
  <div id="step-8" class="step">
    <h2>MIDAS Migren Engellilik Değerlendirme Ölçeği</h2>
    <p>Son 3 ayda migren nedeniyle:</p>
    <label>1. İşe/okula kaç gün gidemediniz?</label><input type="number" id="midas1">
    <label>2. İş/okul performansınız %50’den fazla düştüğü gün sayısı?</label><input type="number" id="midas2">
    <label>3. Ev işlerini yapamadığınız gün sayısı?</label><input type="number" id="midas3">
    <label>4. Ev işleri performansınız %50’den fazla düştüğü gün?</label><input type="number" id="midas4">
    <label>5. Aile/sosyal aktivitelerden vazgeçtiğiniz gün sayısı?</label><input type="number" id="midas5">
    <div style="text-align:center;"><button onclick="finishSurvey()">Anketi Tamamla ve Gönder</button></div>
  </div>

</div>

<script>
  const totalSteps = 9;
  let currentStep = 0;

  function nextStep(n) {
    $('.step').removeClass('active');
    $('#step-'+n).addClass('active');
    currentStep = n;
    updateProgress();
  }

  function saveAndNext(current, next) {
    saveData();
    nextStep(next);
  }

  function updateProgress() {
    const percent = (currentStep / (totalSteps-1)) * 100;
    $('#progress').css('width', percent + '%');
  }

  function saveData() {
    const data = {
      fullName: $('#fullName').val(),
      phone: $('#phone').val(),
      email: $('#email').val(),
      age: $('#age').val(),
      gender: $('#gender').val(),
      education: $('#education').val(),
      work: $('#work').val(),
      headache3months: $('#headache3months').val(),
      photosensitivity: $('#photosensitivity').val(),
      nausea: $('#nausea').val(),
      attacksPerMonth: $('#attacksPerMonth').val(),
      durationHours: $('#durationHours').val(),
      painLevel: $('#painLevel').val(),
      triggers: Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(c=>c.value),
      otherTriggers: $('#otherTriggers').val(),
      midas1: $('#midas1').val(),
      midas2: $('#midas2').val(),
      midas3: $('#midas3').val(),
      midas4: $('#midas4').val(),
      midas5: $('#midas5').val(),
      timestamp: new Date().toISOString()
    };
    localStorage.setItem('migrenSurveyData', JSON.stringify(data));
  }

  function continueLater() {
    Swal.fire({title:'Tamam!',text:'Verileriniz kaydedildi. Tekrar geldiğinizde devam edebilirsiniz.',icon:'info',confirmButtonText:'Kapat'});
  }

  function finishSurvey() {
    saveData();
    const data = JSON.parse(localStorage.getItem('migrenSurveyData'));
    const GOOGLE_SCRIPT_URL = "https://docs.google.com/spreadsheets/d/1r_-cwS7I-1ol45-teNR3GzRZyMRVW2jg74o8Y0baNIY";

    $.post(GOOGLE_SCRIPT_URL, JSON.stringify(data))
      .done(() => {
        Swal.fire('Teşekkür ederiz!','Verileriniz başarıyla kaydedildi ❤️','success');
        localStorage.removeItem('migrenSurveyData');
      })
      .fail(() => Swal.fire('Hata','Bir sorun oluştu, lütfen tekrar deneyin.','error'));
  }

  function showKVKK() {
    Swal.fire({
      title: 'Kişisel Verilerin Korunması Kanunu (KVKK) Aydınlatma Metni',
      html: `
        <div style="text-align:left; font-size:15px; line-height:1.6;">
          <p><strong>Veri Sorumlusu:</strong> Dr. Demirsoy (Nöroloji Araştırmacısı)</p>
          <p><strong>Amaç:</strong> Migren hastalığının günlük yaşama etkisini ve tetikleyicilerini bilimsel olarak incelemek.</p>
          <p><strong>Toplanan Veriler:</strong> Ad-soyad, telefon, e-posta, yaş, cinsiyet, migren atak bilgileri, MIDAS skoru vb.</p>
          <p><strong>Kullanım:</strong> Sadece bu bilimsel araştırma için kullanılacak, anonim hâle getirilerek makale/tezde yer alabilir.</p>
          <p><strong>Paylaşım:</strong> Üçüncü kişilerle paylaşılmayacaktır.</p>
          <p><strong>Saklama Süresi:</strong> Araştırma bitiminden itibaren 5 yıl.</p>
          <p><strong>Haklarınız:</strong> Verilerinize erişme, düzeltme, silme hakkınız vardır.</p>
          <p><strong>İletişim:</strong> Sorularınız için: <u>demirsoy@demirsoy.com</u></p>
        </div>
      `,
      width: '90%',
      maxWidth: '700px',
      confirmButtonText: 'Anladım, Kapat',
      confirmButtonColor: '#60a5fa'
    });
  }

  window.onload = function() {
    const saved = localStorage.getItem('migrenSurveyData');
    if (saved) {
      const data = JSON.parse(saved);
      Object.keys(data).forEach(key => {
        const el = $('#'+key);
        if (el.length) {
          if (el.is(':checkbox')) {
            if (data[key] && data[key].includes(el.val())) el.prop('checked', true);
          } else {
            el.val(data[key]);
          }
        }
      });
    }
  }
</script>
</body>
</html>
